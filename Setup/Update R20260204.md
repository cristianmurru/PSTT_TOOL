# Setup Update R20260204

## Scopo
Distribuire la release 1.1.7 con:
- **Retry schedulazioni in errore** (query/scrittura/Kafka) con ritardo e tentativi configurabili
- **Impostazioni da UI** per `scheduler_retry_enabled`, `scheduler_retry_delay_minutes`, `scheduler_retry_max_attempts`
- Fix precedente: **modifica schedulazioni** preserva selezioni `connessione`/`query`

## File da aggiornare
- Backend/Servizi: `app/services/scheduler_service.py`
- Frontend/Templates: `app/templates/settings.html`, `app/templates/scheduler_dashboard.html`
- Documentazione: `docs/CHANGELOG.md`, `docs/README.md` (badge versione 1.1.7)

## Esclusioni (non copiare)
- `connections.json`
- `.env`
- `exports/` e sottocartelle
- `logs/`

## Procedura (Windows Service)
1. Arresta il servizio PSTT se in esecuzione:
   - Pannello Servizi oppure `Stop-Service -Name "PSTT_TOOL"`
2. Copia i file aggiornati nelle rispettive posizioni.
3. Avvia il servizio:
   - Pannello Servizi oppure `Start-Service -Name "PSTT_TOOL"`
4. Verifica funzionalità:
   - Scheduler Dashboard → Modifica schedulazione: i dropdown `Connessione` e `Query` preservano i valori correnti.
   - Impostazioni (`/settings`): sono visibili e modificabili le chiavi `scheduler_retry_enabled`, `scheduler_retry_delay_minutes`, `scheduler_retry_max_attempts`.
   - Esecuzione schedulazione fallita (simulabile con query molto lenta o export Kafka non raggiungibile): verifica che compaia in storico un evento `retry_scheduled` e che, se lo scheduler è attivo, venga creato un job one‑off con `DateTrigger`.

## Rollback
- Ripristina la precedente versione dei template e, se necessario, disabilita il retry impostando `scheduler_retry_enabled=false` da `/settings`.

## Note
- Suite di test estesa: include verifiche su retry, timeout e normalizzazione cron.
- Il retry è abilitato di default; parametri configurabili da UI o `.env`.
