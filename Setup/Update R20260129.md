# Update R20260129

- Aggiornamento relativo alle modifiche Home/UX su branch `feature/R20260128`.
- Obiettivo: migliorare la visibilità della barra di stato, la navigazione ai risultati e la velocità di ritorno alla selezione query.

## Prerequisiti
- Accesso al server con privilegi amministrativi.
- Finestra di manutenzione concordata (utente non operativo durante l'intervento).
- Percorso di installazione corrente della app (es.: `C:\PSTT_TOOL` o equivalente).
- Nome del Servizio Windows dell'applicazione (es.: `PSTT_TOOL`).
- Pacchetto sorgente aggiornato con i file modificati.

## 1) Stop del Servizio
Scegli una delle opzioni:

- Script di gestione (se presente nella root):
```powershell
# Eseguire nella cartella di installazione
./manage_service.ps1 stop
```

- PowerShell nativo:
```powershell
Stop-Service -Name PSTT_TOOL -Force
# Verifica stato
Get-Service -Name PSTT_TOOL
```

- SC.exe:
```cmd
sc stop PSTT_TOOL
sc query PSTT_TOOL
```

## 2) Backup installazione corrente
Creare una copia di sicurezza dell'installazione:
```powershell
$src = "C:\PSTT_TOOL"
$dst = "C:\Backup\PSTT_TOOL_2026-01-29"
New-Item -ItemType Directory -Path $dst -Force | Out-Null
robocopy $src $dst /MIR /R:2 /W:2
```

## 3) Sovrascrittura file aggiornati (esclusioni)
- Copiare i file aggiornati dal pacchetto sorgente nella cartella di installazione.
- **Non sovrascrivere**:
  - `connections.json`
  - `.env`

Suggerimento: se usi `robocopy`, escludi esplicitamente:
```powershell
robocopy "C:\Pacchetto\PSTT_TOOL" "C:\PSTT_TOOL" /MIR /R:2 /W:2 /XD .venv /XF connections.json .env
```

### Elenco aree con modifiche in R20260129
- Frontend: `app/templates/index.html`, `app/static/js/main.js`
  - Barra di stato spostata tra selezione e risultati
  - Focus automatico e scroll morbido sulla tabella risultati dopo l'esecuzione
  - Nuovo pulsante "Torna a selezione" (reset griglia/contatori e risalita alla selezione)
  - Limite dei filtri dinamici a 6 colonne
  - Ordine pulsanti: `Export Excel` → `Export CSV` → `Torna a selezione`
- Documentazione: `docs/CHANGELOG.md`, `docs/README.md` (badge versione)

#### Dettaglio file da sovrascrivere
- `app/templates/index.html`
- `app/static/js/main.js`
- `docs/CHANGELOG.md`
- `docs/README.md`

## 4) Eccezioni: aggiornare `connections.json` e `.env`
Questi file **non vanno sovrascritti**. Applicare invece le seguenti verifiche/modifiche (solo se necessario):

### 4.1 `connections.json`
- Verificare che la struttura sia valida e che non ci siano modifiche richieste: le modifiche R20260129 **non** introducono nuovi campi.

### 4.2 `.env`
- Nessuna nuova variabile obbligatoria: mantenere credenziali e parametri esistenti.

## 5) Aggiornamento dipendenze (se necessario)
- Confrontare `requirements.txt` tra versione corrente e precedente.
- Se sono cambiati i pacchetti, aggiornare l'ambiente Python:
```powershell
C:\PSTT_TOOL\.venv\Scripts\pip.exe install -r C:\PSTT_TOOL\requirements.txt
```

## 6) Avvio del Servizio
- Script di gestione:
```powershell
./manage_service.ps1 start
```

- PowerShell nativo:
```powershell
Start-Service -Name PSTT_TOOL
Get-Service -Name PSTT_TOOL
```

- SC.exe:
```cmd
sc start PSTT_TOOL
sc query PSTT_TOOL
```

## 7) Verifiche post-deploy
- Home:
  - La barra di stato è visibile tra selezione e risultati.
  - Dopo "Esegui Query" la tabella risultati riceve il focus e la pagina scorre sui risultati.
  - Il pulsante "Torna a selezione" riporta alla sezione di selezione, azzera contatori e nasconde risultati.
  - I filtri dinamici mostrano al massimo 6 input.
- Documentazione:
  - CHANGELOG aggiornato alla versione 1.1.4.
  - README badge versione 1.1.4.

## 8) Rollback
In caso di problemi:
```powershell
Stop-Service -Name PSTT_TOOL -Force
robocopy "C:\Backup\PSTT_TOOL_2026-01-29" "C:\PSTT_TOOL" /MIR /R:2 /W:2
Start-Service -Name PSTT_TOOL
```

## Note operative
- Evitare la sovrascrittura di `connections.json` e `.env`.
- Documentare eventuali personalizzazioni locali prima dell'aggiornamento.
- Archiviare il pacchetto sorgente e il backup per riferimento futuro.
